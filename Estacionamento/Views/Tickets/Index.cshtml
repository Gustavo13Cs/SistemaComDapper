@using Estacionamento.Models
@model IEnumerable<Ticket>

@{
    ViewData["Title"] = "Tickets";
    var tarifas = ViewBag.Tarifas as List<Tarifas>; // recebida do controller
}

<div class="text-center mb-4">
    <h1 class="display-4 fw-bold">Tickets</h1>
    <a class="btn btn-primary btn-novo" asp-controller="Tickets" asp-action="Novo">Novo</a>
</div>

<div class="table-responsive">
    <table class="table table-hover table-bordered text-center align-middle">
        <thead class="table-dark">
            <tr>
                <th>Id</th>
                <th>Nome do Cliente</th>
                <th>Placa do Carro</th>
                <th>Modelo</th>
                <th>Marca</th>
                <th>Local</th>
                <th>Data de Entrada</th>
                <th>Valor Total</th>
                <th>Data de Saída</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                var valorFinal = item.DataSaida.HasValue
                    ? item.Valor
                    : (tarifas != null ? item.CalcularValor(tarifas) : 0);

                <tr>
                    <td>@item.Id</td>
                    <td>@item.Veiculo.Cliente.Nome</td>
                    <td>@item.Veiculo.Placa</td>
                    <td>@item.Veiculo.Marca</td>
                    <td>@item.Veiculo.Modelo</td>
                    <td>@item.Vaga.CodigoLocalizacao</td>
                    <td>@item.DataEntrada.ToString("dd/MM/yyyy HH:mm")</td>
                    <td>@valorFinal?.ToString("C", new System.Globalization.CultureInfo("pt-BR"))</td>
                    <td>@item.DataSaida?.ToString("dd/MM/yyyy HH:mm")</td>
                    <td>
                        <div class="d-flex gap-2 justify-content-center">
                            <form onsubmit="return confirm('Confirma exclusão?')" 
                                  asp-route-id="@item.Id" asp-action="Apagar" asp-controller="Tickets" method="post">
                                <button type="submit" class="btn btn-danger">Excluir</button>
                            </form>
                            <form onsubmit="return confirm('Confirma pagamento?')" 
                                  asp-route-id="@item.Id" asp-action="Pago" asp-controller="Tickets" method="post">
                                <button type="submit" class="btn btn-success">R$ Pago</button>
                            </form>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>
